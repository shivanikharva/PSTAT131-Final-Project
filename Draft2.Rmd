```{r}
# Loading all necessary packages
library(tidyverse)
library(dplyr)
library(tidymodels)
library(readr)
# Assigning the data to a variable
pokemon <- read_csv("data/pokemon.csv")
```

```{r}
# Calling head() to see the first few rows
head(pokemon)
```

```{r}
# Calling dim() to see how many rows and columns
dim(pokemon)
```

```{r}
# Selecting only the variables we want
pokemon <- pokemon %>% 
  select(c("abilities", "attack", "base_total", "capture_rate", "defense", "hp", "name", "sp_attack", "sp_defense", "speed", "type1", "generation", "is_legendary"))
head(pokemon)
```

```{r}
# summary stats
pokemon %>% 
  summary()

# missing values?
colSums(is.na(pokemon))
```

```{r}
# capture rate should not be a character
library(dplyr)
filter(pokemon, capture_rate %in% c("30 (Meteorite)255 (Core)"))
pokemon[pokemon$name=="Minior", "capture_rate"] <- "30"
pokemon$capture_rate <- as.integer(pokemon$capture_rate)
# I chose 30 because the capture rate only rises to 255 if you break its shell
filter(pokemon, name %in% c("Minior"))
```

```{r}
generation_levels <- c(1,2,3,4,5,6,7)
pokemon$generation <- factor(pokemon$generation, levels=generation_levels)
# MAKE IS_LEGENDARY A FACTOR
```

```{r}
pokemon %>% 
  summary()
```

```{r}
library(tidytext)
```

```{r}
test <- pokemon$abilities %>% 
  str_split(pattern = "', '") #%>% 
  # str_extract_all(string = ., pattern = "\\w+", simplify = TRUE)
  # map(str_extract_all(string = ., pattern = "\\w+", simplify = TRUE))
all_abilities <- test %>% map(~ str_replace_all(string = ., pattern = "[[:punct:]]", "")) %>% 
  unlist() %>% as.factor() %>% 
  data.frame(abilities = .)

all_abilities %>% group_by(abilities) %>% summarise(count = n()) %>% 
  arrange(desc(count)) %>% View()
  
#ggplot(data = tibble(all_abilities)) +
 # geom_bar(aes(x = all_abilities))
```

```{r}
pokemon_copy <- pokemon
pokemon_copy$abilities <- pokemon_copy$abilities %>% 
  str_split(pattern = "', '") %>% 
  map(~ str_replace_all(string = ., pattern = "[[:punct:]]", ""))

#tidy_abilities <- pokemon_copy %>% 
#  unnest_tokens(words, abilities)

pokemon_copy2 <- pokemon_copy %>% 
  unnest() 

pokemon_copy2
```

```{r}
library(dplyr)

pokemon_abilities_grouped <- pokemon_copy2 %>% 
  group_by(abilities)

pokemon_abilities_grouped %>% 
  summarise(
    capture_rate = mean(capture_rate)
  ) %>% 
  arrange(desc(capture_rate))

```















